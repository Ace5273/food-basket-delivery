<div style="display:flex;flex-direction: column;">
  <div style="display: flex;
justify-content: space-between;order:-1;">
    <div [class.not-visible]="familyLists.toDeliver.length==0">
      <h4 class="no-print">
        {{familyLists.getLeftFamiliesDescription()}}
      </h4>
      <div
        [class.not-visible]="!(familyLists.toDeliver.length>=1&&familyLists.routeStats&&familyLists.routeStats.totalKm&&showLeftFamilies())"
        class="no-print">
        סה"כ זמן נסיעה מוערך <span *ngIf="familyLists.routeStats"> {{familyLists.routeStats.totalTime}} דקות,
          {{familyLists.routeStats.totalKm}} ק"מ</span>
      </div>
    </div>
    <div class="no-print">
      <mat-menu #appMenu="matMenu">
        <button mat-menu-item (click)="cancelAll()" style="color:red;">{{'בטל שיוך לכל המשפחות'|translate}}</button>
        <button mat-menu-item (click)="okAll()"
          class="primary-menu">{{'סמן נמסר בהצלחה לכל המשפחות'|translate}}</button>
      </mat-menu>

      <button mat-icon-button [matMenuTriggerFor]="appMenu" *ngIf="familyLists.toDeliver.length>1 && partOfAssign">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>
  <h4 *ngIf="!showLeftFamilies()">
    {{allDoneMessage()}}
  </h4>
  <mat-accordion class="no-print">
    <mat-expansion-panel #myPanel *ngFor="let f of familyLists.toDeliver;let i=index">
      <mat-expansion-panel-header>
        <app-family-in-list [f]="f" [i]="i+1" style="width:100%"
          [newAssign]="familyLists.highlightNewFamilies&&!familyLists.familiesAlreadyAssigned.get(f.id.value)">
        </app-family-in-list>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>


        <app-family-info [f]="f" [showHelp]="true" [partOfAssign]="partOfAssign" (assignmentCanceled)="cancelAssign(f)">


          <button mat-raised-button class="myButton" color="primary"
            (click)="deliveredToFamily(f)">{{settings.deliveredButtonText.value}}</button>
          <br  *ngIf="settings.showLeftThereButton.value"/>
          <button *ngIf="settings.showLeftThereButton.value" mat-raised-button class="myButton" (click)="leftThere(f)">השארתי ליד הבית
          </button>
          <br />
          <button mat-raised-button class="myButton badButton" (click)="couldntDeliverToFamily(f)">נתקלתי בבעיה</button>


        </app-family-info>
      </ng-template>
    </mat-expansion-panel>
  </mat-accordion>
  <div class="sendSmsButtonLine no-print" *ngIf="familyLists.toDeliver.length &&(partOfAssign&&!partOfReview||partOfReview&&!helperGotSms)" >
    <button mat-raised-button color="primary"
      style="border-top-left-radius: 0px;border-bottom-left-radius:0px;" (click)="sendSms(false)">שלח הודעת SMS עם
      קישור</button>
    <button  [matMenuTriggerFor]="appMenuSms"
      mat-raised-button color="primary" style="border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      padding-left: 0;
      padding-right: 0;
      min-width: 38px;" (click)="prepareMessage()">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #appMenuSms="matMenu">
      <button mat-menu-item (click)="sendWhatsapp()">שלח קישור ב whatsapp</button>
      <button mat-menu-item (click)="copyMessage()">העתק הודעה עם קישור</button>
      <button mat-menu-item (click)="sendPhoneSms()">שלח קישור בSMS מהטלפון</button>

    </mat-menu>

  </div>
  <button *ngIf="partOfReview&&helperGotSms" mat-raised-button class="myButton no-print" color="primary" (click)="sendSms(true)">

    <span
      *ngIf="familyLists&&familyLists.helperOptional&&familyLists.helperOptional.reminderSmsDate.value; else elseContent">תזכורת
      נשלחה {{familyLists.helperOptional.reminderSmsDate.relativeDateName()}} שלח שוב

    </span>

    <ng-template #elseContent>
      <span>שלחי SMS לתזכורת</span>
    </ng-template>
  </button>
  <button mat-raised-button class="myButton no-print" *ngIf="partOfReview&&familyLists.helperOptional">
    <a href="tel:{{familyLists.helperOptional.phone.value}}"> התקשרי ל{{familyLists.helperOptional.name.value}}
      {{familyLists.helperOptional.phone.value}}
    </a>
  </button>
  <div class="print-only">
    <h4 *ngIf="familyLists.helperId">שלום {{familyLists.helperName}}, {{'אלו המשפחות לחלוקתך -'|translate}}
      ({{familyLists.toDeliver.length}})</h4>
    <table class="printTable">
      <tr>
        <th>{{'משפחה'|translate}}</th>
        <th>כתובת</th>
        <th>טלפונים</th>
        <th>סל</th>
      </tr>
      <tr *ngFor="let f of familyLists.toDeliver;let i=index">
        <td>
          {{i+1}}. {{f.name.value}}
          <ng-container *ngIf="f.deliveryComments.value">
            <br />
            <strong style="color:red">שים לב! </strong> {{f.deliveryComments.value}}
          </ng-container>
        </td>

        <td>
          {{f.address.value}}
          <ng-container *ngIf="f.floor.value||f.appartment.value">
            <br />
          </ng-container>
          <ng-container *ngIf="f.floor.value">
            קומה {{f.floor.value}}
          </ng-container>
          <ng-container *ngIf="f.appartment.value">
            דירה {{f.appartment.value}}
          </ng-container>
          <ng-container *ngIf="f.entrance.value">
            כניסה {{f.entrance.value}}
          </ng-container>
          <ng-container *ngIf="f.addressComment.value">
            <br /> {{f.addressComment.value}}
          </ng-container>
        </td>
        <td>
          {{f.phone1.displayValue}}<ng-container *ngIf="f.phone1Description.value">, {{f.phone1Description.value}}
          </ng-container>
          <div style="margin-top:5px" *ngIf="f.phone2.value">

            <div style="display:inline-block">
              {{f.phone2.displayValue}}, {{f.phone2Description.value?f.phone2Description.value:f.name.value}}

            </div>
          </div>
        </td>
        <td>
          {{f.basketType.displayValue}}
        </td>
      </tr>
      <tr>


      </tr>
    </table>


    <div class="help" *ngIf=" familyLists.toDeliver.length>0">
      <h5>
        צריך עזרה? התקשר ל{{familyLists.toDeliver[0].courierHelpName()}}
        {{familyLists.toDeliver[0].courierHelpPhone()}}
      </h5>
    </div>
  </div>
  <div *ngIf="familyLists.totals.length">
    <h4 class="total-title">סה"כ לחלוקה</h4>
    <ul>
      <li *ngFor="let b of familyLists.totals">{{b.name()}} - {{b.count}}</li>
    </ul>
  </div>




  <div *ngIf="familyLists.problem.length>0" class="no-print">
    <h4>{{'משפחות שנתקלתי בבעיה '|translate}}- {{familyLists.problem.length}}</h4>
    <mat-accordion>
      <mat-expansion-panel #myPanel *ngFor="let f of familyLists.problem">
        <mat-expansion-panel-header>
          <app-family-in-list [f]="f" style="width:100%"></app-family-in-list>
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>
          <app-family-info [f]="f" [showHelp]="true" [partOfAssign]="partOfAssign"
            (assignmentCanceled)="cancelAssign(f)">
            <button mat-raised-button class="myButton" (click)="updateComment(f)">עדכן הערה</button>
            <button mat-raised-button class="myButton badButton"
              (click)="returnToDeliver(f)">{{'נלחץ בטעות - החזר למשפחות'|translate}}
              לחלוקה</button>
            <button *ngIf="partOfAssign" mat-raised-button class="myButton badButton" (click)="cancelAssign(f)">בטלי
              שיוך</button>
          </app-family-info>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <div *ngIf="familyLists.delivered.length>0" class="no-print">
    <h4>{{'משפחות שחולקו ביומיים האחרונים'|translate}} - {{familyLists.delivered.length}}</h4>
    <mat-accordion>
      <mat-expansion-panel #myPanel *ngFor="let f of familyLists.delivered">
        <mat-expansion-panel-header>
          <app-family-in-list [f]="f" style="width:100%"></app-family-in-list>
        </mat-expansion-panel-header>
        <ng-template matExpansionPanelContent>
          <app-family-info [f]="f" [showHelp]="true" (assignmentCanceled)="cancelAssign(f)">
            <button mat-raised-button class="myButton" (click)="updateComment(f)">עדכן הערה</button>
            <button mat-raised-button class="myButton badButton"
              (click)="returnToDeliver(f)">{{'נלחץ בטעות - החזר למשפחות לחלוקה'|translate}}</button>
          </app-family-info>
        </ng-template>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
  <app-map #map [class.hidden]="partOfReview||preview" [style.order]="familyLists.mapElementOrder"> </app-map>

</div>
<button mat-raised-button *ngIf="!preview&&familyLists.toDeliver.length>0" (click)="showRouteOnGoogleMaps()"
  class="map-button">הצג מסלול ב - google maps</button>